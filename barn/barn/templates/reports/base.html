{% extends "base.html" %}

{% block breadcrumbs %}<a href="{% url farmingconcrete.views.index %}">home</a> &gt;&gt; {% endblock %}

{% block head %}
{{ block.super }}    
<script src="{{ MEDIA_URL }}js/OpenLayers/OpenLayers.js" type="text/javascript"></script>
<script src="{{ MEDIA_URL }}js/cloudmade.js" type="text/javascript"></script>
<script src="{{ MEDIA_URL }}js/map.js" type="text/javascript"></script>
<script src="{{ MEDIA_URL }}jquery.tablesorter.min.js" type="text/javascript"></script>
<script type="text/javascript">
$(document).ready(function() {
    $('#map').gardenmap({
        {% block map_options %}
        initialZoom: 10,
        queryString: 'participating=yes&{% if type %}type={{ type.short_name }}&{% endif %}{% if borough %}borough={{ borough }}&{% endif %}year={{ year }}',
        {% endblock %}
    });

    $('table.sorted').tablesorter({
        widgets: ['zebra',],       
    });

    $('.tabs').tabs();

    $('.filter').change(function() {
        function buildQueryString() {
            var params = {};
            $('.filter').each(function() {
                var selection = $(this).find(':selected').val();
                if (selection === 'all') return;
                params[$(this).attr('name')] = selection;
            });
            return params;
        }
        var params = buildQueryString();
        window.location = '/reports/{{ year }}?' + $.param(params);
    });

    {% block extra_scripts %}{% endblock %}
});
</script>
{% endblock %}

{% block content %}

{% block page_title %}{% endblock %}

<div class="map-page report">
    <div id="map" style="width: 100%; height: {% if garden %}150{% else %}350{% endif %}px;"></div>

    {% if not garden %}
    borough:
    <select class="filter" name="borough">
        <option value="all">all</option>
        {% for select_borough in boroughs %}
        <option value="{{ select_borough }}"{% if borough|lower == select_borough|lower %} selected="selected"{% endif %}>{{ select_borough }}</option>
        {% endfor %}
    </select>

    garden type:
    <select class="filter" name="type">
        <option value="all">all</option>
        {% for select_type in garden_types %}
        <option value="{{ select_type.short_name }}"{% if type.short_name == select_type.short_name %} selected="selected"{% endif %}>{{ select_type.name }}s</option>
        {% endfor %}
    </select>
    {% endif %}

    <div class="tabs">
        <ul>
            <li><a href="#cropcount">Crop Count</a></li>
            <li><a href="#harvestcount">Harvest Count</a></li>
            <!--
            TODO if garden
            <li><a href="#other">Other</a></li>
            -->
        </ul>

        <div id="cropcount">
        {% include "reports/cropcount.html" %}
        </div>

        <div id="harvestcount">
        {% include "reports/harvestcount.html" %}
        </div>

        <!--
        TODO if garden
        <div id="other">
            TODO: compare with rest of the city?
            TODO: Estimated yield using crop count (if no harvest count?)
        </div>
        -->
    </div>

    <div id="bottom" style="clear: both;"> </div>
</div>
{% endblock %}

{% block actions %}
{% endblock %}

