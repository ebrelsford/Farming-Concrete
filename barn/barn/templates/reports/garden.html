{% extends "base.html" %}

{% block title %}Report for {{ garden.name }}{% endblock %}

{% block head %}
{{ block.super }}    
<script src="{{ MEDIA_URL }}js/OpenLayers/OpenLayers.js" type="text/javascript"></script>
<script src="{{ MEDIA_URL }}js/cloudmade.js" type="text/javascript"></script>
<script src="{{ MEDIA_URL }}js/map.js" type="text/javascript"></script>
<script src="{{ MEDIA_URL }}jquery.tablesorter.min.js" type="text/javascript"></script>
<script type="text/javascript">
$(document).ready(function() {
    $('#map').gardenmap({
        type: 'single',
        id: {{ garden.id }},   
    });

    $('table.sorted').tablesorter({
        widgets: ['zebra',],       
    });

    $('.collapsible .expander').click(function() {
        $(this).parent().toggleClass('collapsed');
        return false;
    });

    $('.share > a').click(function() {
        if ($(this).parent().hasClass('shared')) return false;
        $.getJSON('{% url reports.views.share id=garden.id %}', function(data) {
            $('.share .sharebox').find('.url').text(data.url).attr('href', data.url);
            $('.share').addClass('shared')
        });
        return false;
    });

    $('.tabs').tabs();
});
</script>
{% endblock %}

{% block content %}
<h1>{{ garden.name }}</h1>
<div>2011 Farming Concrete Report</div>

<div class="map-page report">
    <div id="left">
        <div class="tabs">
            <ul>
                <li><a href="#cropcount">Crop Count</a></li>
                <li><a href="#harvestcount">Harvest Count</a></li>
                <!--
                <li><a href="#other">Other</a></li>
                -->
            </ul>

            <div id="cropcount">
            {% include "reports/cropcount.html" %}
            </div>

            <div id="harvestcount">
            {% include "reports/harvestcount.html" %}
            </div>

            <!--
            <div id="other">
                TODO: compare with rest of the city?
                TODO: Estimated yield using crop count (if no harvest count?)
            </div>
            -->
        </div>
    </div>

    <div id="right">
        <div id="map" style="width: 300px; height: 200px;"></div>
    </div>

    <div id="bottom" style="clear: both;"> </div>
</div>
{% endblock %}

{% block actions %}
{% if user.is_authenticated %}
<h2 class="share">
    <a class="image" href="{% url harvestcount.views.index %}"><img src="{{ MEDIA_URL }}img/mail.png" /></a>
    <a class="text" href="{% url harvestcount.views.index %}">Share this report</a>
    <div class="sharebox">
        <p><a class="url" target="_blank"></a></p>
        <p>This report is now publicly accessible using the above url. Please only share it with those who should see the report.</p>
    </div>
</h2>
{% endif %}
{% endblock %}
