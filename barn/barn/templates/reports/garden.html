{% extends "base.html" %}

{% block title %}Report for {{ garden.name }}{% endblock %}

{% block head %}
{{ block.super }}    
<script src="{{ MEDIA_URL }}js/OpenLayers/OpenLayers.js" type="text/javascript"></script>
<script src="{{ MEDIA_URL }}js/cloudmade.js" type="text/javascript"></script>
<script src="{{ MEDIA_URL }}js/map.js" type="text/javascript"></script>
<script src="{{ MEDIA_URL }}jquery.tablesorter.min.js" type="text/javascript"></script>
<script type="text/javascript">
$(document).ready(function() {
    $('#map').gardenmap({
        type: 'single',
        id: {{ garden.id }},   
    });

    $('table.sorted').tablesorter({
        widgets: ['zebra',],       
    });

    $('.collapsible .expander').click(function() {
        $(this).parent().toggleClass('collapsed');
        return false;
    });
});
</script>
{% endblock %}

{% block content %}
<h1>{{ garden.name }}</h1>
<div>2011 Farming Concrete Report</div>

<div class="map-page report">
    <div id="left">
        {% if beds %}
        <div id="cropcount" style="border-bottom: 1px dashed black; margin-bottom: 100px;">
            <h2>Crop Count</h2>
            <div class="beds section collapsible collapsed">
                <h3 class="expander"><a href="#">Click to show/hide full crop count</a></h3>
                <div class="expandee">
                {% include "cropcount/gardens/snippet.html" %}
                </div>
            </div>
            <div class="totals section">
                <h3>Totals</h3>
                <table class="totals cycled">
                    <tr class="odd">
                        <th>number of beds</th><td>{{ total_beds }}</td>
                    </tr>
                    <tr class="even">
                        <th>area under production</th><td>{{ total_area|floatformat }} sq ft</td>
                    </tr>
                    <tr class="odd">
                        <th>plants</th><td>{{ total_plants }}</td>
                    </tr>
                </table>
                <h4>plants per crop</h4>
                <table class="sorted">
                    <thead>
                        <tr>
                            <th>plant type</th>
                            <th>plants</th>
                            <th>area</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for crop in crops %}
                        <tr>
                            <td>{{ crop.variety__name }}</td>
                            <td>{{ crop.plants|default:"" }}</td>
                            <td>{{ crop.area|default:"" }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <img src="{% url reports.views.bar_chart_plants_per_crop id=garden.id %}" />
            </div>
        </div>
        {% endif %}

        {% if harvests %}
        <h2>Harvest Count</h2>
        <div class="harvests section">
            <h3>Details</h3>
            {% include "harvestcount/gardens/snippet.html" %}
        </div>
        <div class="section">
            <h3>Totals</h3>
            <strong>total weight:</strong> {{ total_weight }} pounds
            <div class="subsection">
                <h4>total weighed by crop</h4>
                <table class="sorted">
                    <thead>
                        <tr>
                            <th>plant type</th>
                            <th>lbs</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for harvest_total in harvest_totals %}
                        <tr>
                            <td>{{ harvest_total.variety__name }}</td>
                            <td>{{ harvest_total.weight|floatformat }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <img src="{% url reports.views.bar_chart_weight_per_crop id=garden.id %}" />
            </div>
            <div class="subsection">
                <h4>total weighed by gardener</h4>
                <table class="sorted">
                    <thead>
                        <tr>
                            <th>gardener name</th>
                            <th>lbs</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for gardener_total in gardener_totals %}
                        <tr>
                            <td>{{ gardener_total.gardener__name }}</td>
                            <td>{{ gardener_total.weight|floatformat }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <img src="{% url reports.views.bar_chart_weight_per_gardener id=garden.id %}" />
            </div>
        </div>
        {% endif %}

        <div id="other">
            TODO: compare with rest of the city?
            TODO: Estimated yield using crop count (if no harvest count?)
        </div>
    </div>

    <div id="right">
        <div id="map" style="width: 300px; height: 200px;"></div>
    </div>

    <div id="bottom" style="clear: both;"> </div>
</div>
{% endblock %}
