{% extends "harvestcount/gardens/base.html" %}

{% block title %}{{ garden.name }}{% endblock %}

{% block head %}
    <script src="/site_media/js/OpenLayers/OpenLayers.js" type="text/javascript"></script>
    <script src="/site_media/js/cloudmade.js" type="text/javascript"></script>
    <script src="/site_media/js/jquery-util.js" type="text/javascript"></script>
    <script src="/site_media/js/map.js" type="text/javascript"></script>
    <script src="/site_media/js/help.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $('#map').gardenmap({
                type: 'single',
                id: {{ garden.id }},   
            });

            $('a.delete').click(function(event) {
                if (!confirm("Are you sure you want to delete this harvest?")) {
                    return false;
                }
            });

            $('#gardener_help').help({ text: 'Pick the gardener who grew this.' });
            $('#variety_help').help({ text: 'Pick the type of plant.' });
            $('#weight_help').help({ text: 'Enter the weight of the harvest.' });
        });   
    </script>
{% endblock %}

{% block breadcrumbs %}{{ block.super }}{{ garden.name }}{% endblock %}

{% block content %}
{% if garden %}
    <h1>{{ garden.name }}</h1>

    <div id="left">
    <div id="harvests">
        <ul class="values">
            {% for harvest in harvests %}
            <li class="harvest {% cycle 'odd' 'even' %}">
                <span class="gardener">
                    {# link to gardener? #}
                    {{ harvest.gardener.name }}
                </span> 
                <span class="variety">
                    {{ harvest.variety.name }}
                </span>
                <span class="weight">
                    {{ harvest.weight }} pounds
                </span>
                <span class="dimensions">
                    {% if harvest.plants %}
                    {{ harvest.plants }} plants
                    {% endif %}
                    
                    {% if harvest.area %}
                    ({{ harvest.area }} square feet)
                    {% endif %}
                </span>
                <span class="harvested">
                    {{ harvest.harvested|date:"n/j/y" }}
                </span>
                <span class="actions">
                    {# delete #}
                        <img src="/site_media/img/round_delete_small.png" title="remove this bed" />
                </span>
            </li>
            {% endfor %}

            <li id="new-harvest">
                <span style="font-weight: bold; margin-top: 5px;">Add a new harvest</span>
                <form method="post" action=".">
                    {% csrf_token %}
                    {% for hidden in form.hidden_fields %}
                    {{ hidden }}
                    {% endfor %}
                    {{ form.non_field_errors }}
                    <div id="errors">
                        {{ form.errors }}
                        {{ form.gardener.errors }}{{ form.name.errors }}{{ form.length.errors }}{{ form.width.errors }}
                    </div>
                    <div id="inputs">
                        <div>
                            Gardener: {{ form.gardener }} <span id="gardener_help" class="help_link">help!</span><br />
                            Plant type: {{ form.variety }} <span id="variety_help" class="help_link">help!</span><br />
                            Weight: {{ form.weight }} pounds <span id="weight_help" class="help_link">help!</span><br />
                            Number of plants: {{ form.plants }}<br />
                            Date: {{ form.harvested }}
                        </div>
                        <input type="submit" value="add" />
                    </div>
                </form>
            </li>
        </ul>
    </div>
    </div>

    <div id="right">
        <div id="map" style="width: 300px; height: 200px;"></div>
        <ul class="overview">
            <li><b>{{ harvests.count|default:"0" }}</b> harvests</li>
            <li><b>{{ weight|default:"0" }}</b> pounds</li>
            <li><b>{{ plant_types|default:"0" }}</b> plant types</li>
        </ul>
    </div>

    <div id="bottom" style="clear: both;">
        <div id="no-more-harvests" class="complete">
            <h2>
                <a class="image" href="{% url harvestcount.views.index %}"><img src="/site_media/img/round_checkmark.png" /></a>
                <a class="text" href="{% url harvestcount.views.index %}">Done adding harvests to this garden!</a>
            </h2>
        </div>
    </div>
{% else %}
    <p>No such garden</p>
{% endif %}
{% endblock %}

