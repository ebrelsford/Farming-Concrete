{% extends "harvestcount/map_base.html" %}

{% block title %}{{ garden.name }}{% endblock %}
{% block header_title %}{{ garden.name }}{% endblock %}

{% block map_params %}
type: 'single',
id: {{ garden.id }},   
{% endblock %}

{% block head %}
{{ block.super }}
{% if not is_mobile %}
<script src="{{ MEDIA_URL }}js/help.js" type="text/javascript"></script>
<script src="{{ MEDIA_URL }}jquery.tablesorter.min.js" type="text/javascript"></script>
<script type="text/javascript">
$(document).ready(function() {
    $('a.delete').click(function(event) {
        if (!confirm("Are you sure you want to delete this harvest?")) {
            return false;
        }
    });

    $('#id_harvested').datepicker({
        dateFormat: 'mm/dd/yy',
        maxDate: '+0D',
        buttonImage: '{{ MEDIA_URL }}img/calendar_1.png',
        buttonImageOnly: true,
        showOn: 'both',
    });

    $('#id_gardener_text, #id_variety_text').focusout(function() {
        var gardener = $('#id_gardener_text').val();
        var variety = $('#id_variety_text').val();
        if (gardener && gardener !== '' && variety && variety !== '') {
            $.getJSON('last_harvest?gardener=' + gardener + '&variety=' + variety, function(h) {
                $('#id_plants').val(h.plants);   
                $('#id_area').val(h.area);   
            });
        }
    });

    $('#gardener_help').help({ text: 'Pick the gardener who grew this.' });
    $('#variety_help').help({ text: 'Pick the type of plant.' });
    $('#weight_help').help({ text: 'Enter the weight of the harvest.' });
    $('#plants_help').help({ text: 'Enter the number of plants the harvest came from. This may seem redundant if you did a crop count for this garden, but we assume that not everyone doing harvest count will do crop count. We also assume that some gardeners might only weigh the produce for a segment of their crop.' });
    $('#harvested_help').help({ text: 'Enter the date the harvest was taken. This helps us look at harvest over time and estimate yields for rotations within a growing season.' });

    $('table.sorted').tablesorter({
        widgets: ['zebra',],       
    });
});   
{% endif %}
</script>
{% endblock %}

{% block breadcrumbs %}{{ block.super }}{{ garden.name }}{% endblock %}

{% block content %}
{% if garden %}
    {% if not is_mobile %}
    <h1>{{ garden.name }}</h1>
    {% endif %}

    <div class="garden-details">
    {{ block.super }}
    </div>
{% else %}
    <p>No such garden</p>
{% endif %}
{% endblock %}

{% block left %}

{% if is_mobile %}
<ul class="overview pre-listview">
    <li><b>{{ harvests.count|default:"0" }}</b> harvest{{ harvests.count|pluralize }}</li>
    <li><b>{{ weight|floatformat|default:"0" }}</b> pounds</li>
    <li><b>{{ plant_types|default:"0" }}</b> plant type{{ harvests.count|pluralize }}</li>
</ul>
{% endif %}

{% if not is_mobile %}
{% include "harvestcount/harvests/add_snippet.html" %}
{% endif %}

{% include "harvestcount/harvests/list_snippet.html" %}

{% endblock %}

{% block right %}
{% if not is_mobile %}
<ul class="overview">
    <li><b>{{ harvests.count|default:"0" }}</b> harvest{{ harvests.count|pluralize }}</li>
    <li><b>{{ weight|floatformat|default:"0" }}</b> pounds</li>
    <li><b>{{ plant_types|default:"0" }}</b> plant type{{ harvests.count|pluralize }}</li>
</ul>
{% endif %}
{% endblock %}

{% block actions %}
<h2>
    <a class="image" href="{% url harvestcount.views.download_garden_harvestcount_as_csv id=garden.id year=request.session.year %}"><img src="{{ MEDIA_URL }}img/download.png" /></a>
    <a class="text" href="{% url harvestcount.views.download_garden_harvestcount_as_csv id=garden.id year=request.session.year %}">Download this as a spreadsheet</a>
</h2>
<h2>
    <a class="image" href="{% url reports.views.garden_report id=garden.id year=request.session.year %}"><img src="{{ MEDIA_URL }}img/round_arrow_right.png" /></a>
    <a class="text" href="{% url reports.views.garden_report id=garden.id year=request.session.year %}">View this garden's report</a>
</h2>
<h2>
    <a class="image" href="{% url cropcount.views.garden_details id=garden.id year=request.session.year %}"><img src="{{ MEDIA_URL }}img/round_arrow_right.png" /></a>
    <a class="text" href="{% url cropcount.views.garden_details id=garden.id year=request.session.year %}">Switch to Crop Count</a>
</h2>
{{ block.super }}
<h2>
    <a class="image" href="{% url harvestcount.views.index year=request.session.year %}"><img src="{{ MEDIA_URL }}img/round_checkmark.png" /></a>
    <a class="text" href="{% url harvestcount.views.index year=request.session.year %}">Done adding harvests to this garden!</a>
</h2>
{% endblock %}
