{% extends "cropcount/gardens/base.html" %}

{% block title %}{{ garden.name }}{% endblock %}

{% block head %}
<script src="{{ MEDIA_URL }}js/OpenLayers/OpenLayers.js" type="text/javascript"></script>
<script src="{{ MEDIA_URL }}js/cloudmade.js" type="text/javascript"></script>
<script src="{{ MEDIA_URL }}js/map.js" type="text/javascript"></script>
<script src="{{ MEDIA_URL }}js/help.js" type="text/javascript"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $('#map').gardenmap({
            type: 'single',
            id: {{ garden.id }},   
        });

        $('a.delete').click(function(event) {
            if (!confirm("Are you sure you want to delete this bed?")) {
                return false;
            }
        });

        $('#number_help').help({ text: 'Enter the number for this bed. If you do not have a number for the bed, the default given should be okay.' });
        $('#dimensions_help').help({ text: 'Enter the dimensions for this bed. This helps us determine how much space is being used to grow food.' });
    });   
</script>
{% endblock %}

{% block breadcrumbs %}{{ block.super }}{{ garden.name }}{% endblock %}

{% block content %}
{% if garden %}
    <h1>{{ garden.name }}</h1>

    <div id="left">
        <div id="new-bed" style="border-bottom: 2px solid black; margin-bottom: 10px;">
            <span style="font-weight: bold;">Add a new bed to this garden</span>
            <form method="post" action=".">
                {% csrf_token %}
                {% for hidden in form.hidden_fields %}
                {{ hidden }}
                {% endfor %}
                <div id="errors">
                    {{ form.non_field_errors }}
                    {{ form.garden.errors }}{{ form.name.errors }}{{ form.width.errors }}{{ form.length.errors }}
                </div>
                <div id="inputs">
                    <div>
                        {{ form.name.label_tag }}: {{ form.name }} <span id="number_help" class="help_link"></span><br />
                    </div>
                    <div>
                        {{ form.width.label_tag }}: {{ form.width }}ft x {{ form.length }}ft <span id="dimensions_help" class="help_link"></span>
                    </div>
                    <input type="submit" value="add" />
                </div>
            </form>
        </div>
        <div id="beds">
            <span style="font-weight: bold;">Current beds in this garden</span>
            <ul class="values">
                {% for box in garden.box_set.all %}
                <li class="bed">
                    <span class="name">
                        <a href="{% url cropcount.views.bed_details box.id %}">bed {{ box.name }}</a>
                    </span> 
                    <span class="dimensions">
                        {{ box.width }} ft x {{ box.length }} ft
                    </span>
                    <span class="actions">
                        <a class="delete" href="{% url cropcount.views.delete_bed box.id %}">
                            <img src="{{ MEDIA_URL }}img/round_delete_small.png" title="remove this bed" />
                        </a>
                    </span>
                    <div id="plants">
                        <ul class="values">
                            {% for patch in box.patch_set.all %}
                            <li class="{% cycle 'odd' 'even' %}">
                                <span class="type">{{ patch.variety.name }}</span>
                                
                                <span class="quantity">
                                    {% if patch.plants %}
                                    {{ patch.plants }} plants
                                    {% endif %}
                                    {% if patch.area %}
                                    {{ patch.area }} square feet
                                    {% endif %}
                                </span>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </li>
            {% empty %}
                <li>None yet!</li>
            {% endfor %}
            </ul>
        </div>
    </div>

    <div id="right">
        <div id="map" style="width: 300px; height: 200px;"></div>
        <ul class="overview">
            <li><b>{{ beds|default:"0" }}</b> beds</li>
            <li><b>{{ area|default:"0" }}</b> square feet</li>
            <li><b>{{ plants|default:"0" }}</b> plants</li>
        </ul>
    </div>

    <div id="bottom" style="clear: both;">
        <div id="no-more-beds" class="complete">
        </div>
    </div>
{% else %}
    <p>No such garden</p>
{% endif %}
{% endblock %}

{% block actions %}
{{ block.super }}
<h2>
    <a class="image" href="{% url cropcount.views.user_gardens %}"><img src="{{ MEDIA_URL }}img/round_checkmark.png" /></a>
    <a class="text" href="{% url cropcount.views.user_gardens %}">Done adding beds to this garden!</a>
</h2>
{% endblock %}
