{% load widget_tweaks %}

<script>
    $(document).ready(function() {
        {% if is_mobile %}
        $('#area-flip').change(function() {
            $('#area-input').toggle();
        });
        $('a.remember-context').click(function(e) {
            var current_form = $('form :input[name!="csrfmiddlewaretoken"]').serialize();

            var new_url = $(this).attr('href') + '?' + $.param({
                previous: window.location.pathname,
                previous_query_string: current_form,
            });
            $.mobile.changePage(new_url, {
                role: $(this).attr('data-rel'),
            });
            return false;
        });
        {% else %}
        $('#add-new-plant-type a').click(function() {
            $('#add-new-plant-type .adder').toggle();   
            return false;
        });

        var add_plant_type_url = '{% url "farmingconcrete_varieties_add" %}';

        /*
         * Add plant type when form is submitted.
         */
        $('form').submit(function(e) {
            var name = $('input[name="new-plant-type"]').val();
            get_or_create_plant_type(add_plant_type_url, name, true, function() {});
        });   

        /*
         * Add plant type when person tabs out of plant type field.
         */
        $(':input#id_variety_text').blur(function() {
            // only try to add plant type if autocomplete didn't get something
            if ($(':input#id_variety').val() !== '') return;
            get_or_create_plant_type(add_plant_type_url, $(this).val(), false, function() {});
        });

        {% endif %}
    });
</script>
<section id="new-harvest" class="add-record">
    <h2>Add a new harvest</h2>
    <form method="post" action="{% url "harvestcount_add_harvest" id=garden.id %}" class="form-horizontal">
        {% csrf_token %}
        {% for hidden in form.hidden_fields %}
            {{ hidden }}
        {% endfor %}
        <div id="errors">
            {{ form.non_field_errors }}
        </div>

        <div class="form-group required">
            {{ form.gardener.errors }}
            <div class="control-label col-lg-4">
                {{ form.gardener.label_tag }}
                <span id="gardener_help" class="help_link tooltip-trigger" data-title="Pick the gardener who grew this." data-container="body">?</span>
            </div>
            <div class="col-lg-6">
                <div class="controls">
                    {% render_field form.gardener class+="form-control" %} 
                </div>
            </div>
        </div>

        <div class="form-group required">
            {{ form.variety.errors }}
            <div class="control-label col-lg-4">
                {{ form.variety.label_tag }}
            </div>
            <div class="col-lg-6">
                <div class="controls">
                    {% render_field form.variety class+="form-control" %} 
                </div>
            </div>
        </div>

        <div class="form-group required">
            {{ form.weight.errors }}
            <div class="control-label col-lg-4">
                {{ form.weight.label_tag }}
            </div>
            <div class="col-lg-6">
                <div class="controls input-group">
                    {% render_field form.weight class+="form-control" %}
                    <span class="input-group-addon">pounds</span>
                </div>
            </div>
        </div>

        <div class="form-group required">
            {{ form.plants.errors }}{{ form.area.errors }}
            <div class="control-label col-lg-4">
                <label for="id_plants">Plants or area</label>
                <span id="plants_help" class="help_link tooltip-trigger" data-title="Enter the number of plants that the harvest came from. If the type of plant grows densely and difficult to count, enter the area the plant was growing in." data-container="body">?</span>
            </div>
            <div class="col-lg-6">
                <div class="controls">
                    <div class="input-group">
                        {% render_field form.plants class+="form-control" %}
                        <span class="input-group-addon">plants</span>
                    </div>
                    <div class="input-group">
                        {% render_field form.area class+="form-control" %}
                        <span class="input-group-addon">sq ft</span>
                    </div>
                </div>
            </div>
        </div>

        {% include "forms/field.html" with field=form.recorded %}

        <div class="clearfix"></div>

        <div class="form-actions col-lg-offset-4 col-lg-6">
            <button type="submit" class="btn btn-primary">add</button>
        </div>
        <div class="clearfix"></div>

    </form>
</section>
